{"ast":null,"code":"import { isEmptyObject, mapValues, toServerDuration } from '@datadog/browser-core';\nimport { RumEventType } from '../../../rawRumEvent.types';\nimport { LifeCycleEventType } from '../../lifeCycle';\nimport { trackViews } from './trackViews';\nexport function startViewCollection(lifeCycle, configuration, location, domMutationObservable, foregroundContexts, initialViewName) {\n  lifeCycle.subscribe(LifeCycleEventType.VIEW_UPDATED, function (view) {\n    return lifeCycle.notify(LifeCycleEventType.RAW_RUM_EVENT_COLLECTED, processViewUpdate(view, foregroundContexts));\n  });\n  var shouldTrackViewsAutomatically = !configuration.isEnabled('view-renaming') || !configuration.trackViewsManually;\n  return trackViews(location, lifeCycle, domMutationObservable, shouldTrackViewsAutomatically, initialViewName);\n}\n\nfunction processViewUpdate(view, foregroundContexts) {\n  var viewEvent = {\n    _dd: {\n      document_version: view.documentVersion\n    },\n    date: view.startClocks.timeStamp,\n    type: RumEventType.VIEW,\n    view: {\n      action: {\n        count: view.eventCounts.userActionCount\n      },\n      cumulative_layout_shift: view.cumulativeLayoutShift,\n      dom_complete: toServerDuration(view.timings.domComplete),\n      dom_content_loaded: toServerDuration(view.timings.domContentLoaded),\n      dom_interactive: toServerDuration(view.timings.domInteractive),\n      error: {\n        count: view.eventCounts.errorCount\n      },\n      first_contentful_paint: toServerDuration(view.timings.firstContentfulPaint),\n      first_input_delay: toServerDuration(view.timings.firstInputDelay),\n      first_input_time: toServerDuration(view.timings.firstInputTime),\n      is_active: view.isActive,\n      name: view.name,\n      largest_contentful_paint: toServerDuration(view.timings.largestContentfulPaint),\n      load_event: toServerDuration(view.timings.loadEvent),\n      loading_time: toServerDuration(view.loadingTime),\n      loading_type: view.loadingType,\n      long_task: {\n        count: view.eventCounts.longTaskCount\n      },\n      resource: {\n        count: view.eventCounts.resourceCount\n      },\n      time_spent: toServerDuration(view.duration),\n      in_foreground_periods: foregroundContexts.getInForegroundPeriods(view.startClocks.relative, view.duration)\n    },\n    session: {\n      has_replay: view.hasReplay || undefined\n    }\n  };\n\n  if (!isEmptyObject(view.customTimings)) {\n    viewEvent.view.custom_timings = mapValues(view.customTimings, toServerDuration);\n  }\n\n  return {\n    rawRumEvent: viewEvent,\n    startTime: view.startClocks.relative,\n    domainContext: {\n      location: view.location\n    }\n  };\n}","map":{"version":3,"sources":["../../../../src/domain/rumEventsCollection/view/viewCollection.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { isEmptyObject, mapValues, toServerDuration, } from '@datadog/browser-core';\nimport { RumEventType } from '../../../rawRumEvent.types';\nimport { LifeCycleEventType } from '../../lifeCycle';\nimport { trackViews } from './trackViews';\nexport function startViewCollection(lifeCycle, configuration, location, domMutationObservable, foregroundContexts, initialViewName) {\n    lifeCycle.subscribe(LifeCycleEventType.VIEW_UPDATED, function (view) {\n        return lifeCycle.notify(LifeCycleEventType.RAW_RUM_EVENT_COLLECTED, processViewUpdate(view, foregroundContexts));\n    });\n    var shouldTrackViewsAutomatically = !configuration.isEnabled('view-renaming') || !configuration.trackViewsManually;\n    return trackViews(location, lifeCycle, domMutationObservable, shouldTrackViewsAutomatically, initialViewName);\n}\nfunction processViewUpdate(view, foregroundContexts) {\n    var viewEvent = {\n        _dd: {\n            document_version: view.documentVersion,\n        },\n        date: view.startClocks.timeStamp,\n        type: RumEventType.VIEW,\n        view: {\n            action: {\n                count: view.eventCounts.userActionCount,\n            },\n            cumulative_layout_shift: view.cumulativeLayoutShift,\n            dom_complete: toServerDuration(view.timings.domComplete),\n            dom_content_loaded: toServerDuration(view.timings.domContentLoaded),\n            dom_interactive: toServerDuration(view.timings.domInteractive),\n            error: {\n                count: view.eventCounts.errorCount,\n            },\n            first_contentful_paint: toServerDuration(view.timings.firstContentfulPaint),\n            first_input_delay: toServerDuration(view.timings.firstInputDelay),\n            first_input_time: toServerDuration(view.timings.firstInputTime),\n            is_active: view.isActive,\n            name: view.name,\n            largest_contentful_paint: toServerDuration(view.timings.largestContentfulPaint),\n            load_event: toServerDuration(view.timings.loadEvent),\n            loading_time: toServerDuration(view.loadingTime),\n            loading_type: view.loadingType,\n            long_task: {\n                count: view.eventCounts.longTaskCount,\n            },\n            resource: {\n                count: view.eventCounts.resourceCount,\n            },\n            time_spent: toServerDuration(view.duration),\n            in_foreground_periods: foregroundContexts.getInForegroundPeriods(view.startClocks.relative, view.duration),\n        },\n        session: {\n            has_replay: view.hasReplay || undefined,\n        },\n    };\n    if (!isEmptyObject(view.customTimings)) {\n        viewEvent.view.custom_timings = mapValues(view.customTimings, toServerDuration);\n    }\n    return {\n        rawRumEvent: viewEvent,\n        startTime: view.startClocks.relative,\n        domainContext: {\n            location: view.location,\n        },\n    };\n}\n//# sourceMappingURL=viewCollection.js.map"]},"metadata":{},"sourceType":"module"}